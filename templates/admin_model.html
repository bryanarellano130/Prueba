{% extends 'base.html' %}

{% block title %}Admin - ConfiguraciÃ³n del Modelo{% endblock %}

{% block content %}
<h1>ğŸ› ï¸ Admin - ConfiguraciÃ³n del Modelo</h1>
<p>Gestiona el modelo de Machine Learning para la detecciÃ³n de amenazas.</p>

{# SecciÃ³n para mostrar el estado actual del modelo #}
<div class="info-section">
    <h2>Estado del Modelo</h2>
    {# Asumimos que pasas info del modelo a la plantilla, ej. 'model_info' #}
    {% if model_info is defined and model_info is not none %}
        <p><strong>Tipo de Modelo:</strong> {{ model_info.get('Model Type', 'N/A') }}</p>
        <p><strong>Estado del Scaler:</strong> {{ model_info.get('Scaler Type', 'N/A') }} (Ajustado: {{ model_info.get('Scaler Fitted', 'N/A') }})</p>
        <p><strong>Umbral de PredicciÃ³n:</strong> {{ model_info.get('Prediction Threshold', 'N/A') }}</p>
        {# Puedes aÃ±adir mÃ¡s detalles del modelo si tu get_model_info los retorna #}
        {# <p>Ruta Modelo: {{ model_info.get('Model Path', 'N/A') }}</p> #}
        {# <p>Ruta Scaler: {{ model_info.get('Scaler Path', 'N/A') }}</p> #}

         {# Mostrar mensaje si el modelo o scaler no estÃ¡n cargados #}
         {% if not model_info.get('Model Type', 'N/A') != 'No cargado' or model_info.get('Scaler Fitted', 'No') != 'SÃ­' %}
             <p class="alert alert-warning" style="margin-top: 0.5rem;">El modelo y/o scaler no estÃ¡n cargados o ajustados. La detecciÃ³n no funcionarÃ¡ correctamente.</p>
         {% endif %}

    {% else %}
        <p>InformaciÃ³n del modelo no disponible.</p>
    {% endif %}
</div>

{# SecciÃ³n para actualizar el umbral de predicciÃ³n #}
<div class="action-card" style="margin-top: 2rem;">
    <h2>Configurar Umbral de PredicciÃ³n</h2>
    {# Formulario para actualizar el umbral. Asume que la ruta admin_model_config maneja POST. #}
    <form method="POST" action="{{ url_for('admin_model_config') }}">
        {# Opcional: Token CSRF #}
        {# {{ form.csrf_token }} #}
        <div class="form-group">
            <label for="prediction_threshold">Nuevo Umbral (0.0 a 1.0):</label>
            {# Usar el valor actual si estÃ¡ disponible, si no un placeholder #}
            {# Asumiendo que pasas 'current_config' o similar a la plantilla con la config de admin/alert manager #}
            <input type="number" id="prediction_threshold" name="prediction_threshold"
                   value="{{ current_config.get('glm_threshold', 0.7) if current_config is defined else 0.7 }}"
                   step="0.01" min="0.0" max="1.0" required> {# Usar step="0.01" para permitir decimales #}
        </div>
        <div class="form-group">
            <button type="submit" name="action" value="update_threshold" class="button">Actualizar Umbral</button> {# Usar name="action" para identificar #}
        </div>
    </form>
</div>

{# SecciÃ³n para reentrenar el modelo #}
<div class="action-card" style="margin-top: 2rem;">
    <h2>Re-entrenar Modelo</h2>
    <p>Utiliza un dataset de entrenamiento para reentrenar el modelo y el scaler.</p>
    {# Formulario para reentrenar. Esto probablemente deberÃ­a ser una operaciÃ³n POST. #}
    {# Asume que la ruta admin_model_config maneja POST y la acciÃ³n 'retrain'. #}
    <form method="POST" action="{{ url_for('admin_model_config') }}">
         {# Indicar la acciÃ³n #}
        <input type="hidden" name="action" value="retrain">
        {# Opcional: Campo para seleccionar el dataset de entrenamiento si no usas uno fijo #}
        {# <div class="form-group"> #}
        {# Â  Â  <label for="dataset">Dataset de Entrenamiento:</label> #}
        {# Â  Â  <input type="text" id="dataset" name="dataset" placeholder="Ruta al archivo CSV"> #}
        {# </div> #}
        <div class="form-group">
            <button type="submit" class="button button-warning"
                    onclick="return confirm('Â¿EstÃ¡s seguro de que deseas iniciar el re-entrenamiento? Esto puede tardar varios minutos.');">
                Iniciar Re-entrenamiento
            </button>
        </div>
    </form>
    {# Puedes aÃ±adir aquÃ­ un Ã¡rea para mostrar el estado del reentrenamiento si es asÃ­ncrono #}
</div>

{# Opcional: Historial de Reentrenamientos #}
{# <div class="info-section" style="margin-top: 2rem;"> #}
{# Â  Â  <h2>Historial de Reentrenamientos</h2> #}
{# Â  Â  <p>Tabla con fechas, datasets usados y mÃ©tricas del reentrenamiento.</p> #}
{# Â  Â  {% if retraining_history %} #}
{# Â  Â  Â  Â  ... Tabla del historial ... #}
{# Â  Â  {% else %} #}
{# Â  Â  Â  Â  <p>No hay historial de reentrenamientos.</p> #}
{# Â  Â  {% endif %} #}
{# </div> #}


{% endblock %}

{% block extra_js %}
<script>
    console.log("Admin Model JS loaded");
    // Puedes aÃ±adir JS aquÃ­ para validaciÃ³n adicional del umbral, mostrar progreso del reentrenamiento, etc.
</script>
{% endblock %}