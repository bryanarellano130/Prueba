<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Sistema de Ciberseguridad{% endblock %} - CyberSystem</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    {# Favicon con un emoji de escudo #}
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üõ°Ô∏è</text></svg>">
    {# Opcional: A√±adir otros metadatos como descripci√≥n, autor, etc. #}
</head>
<body>
    <nav class="navbar">
        <div class="container">
            {# Marca o logo con enlace al dashboard #}
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">üõ°Ô∏è CyberSystem</a>
            <div class="navbar-links">
                {# Links principales de navegaci√≥n #}
                {# Los mostramos solo si el usuario est√° autenticado #}
                {% if current_user.is_authenticated %}
                    {# Enlace al Panel (Dashboard) #}
                    <a href="{{ url_for('dashboard') }}" class="{{ 'active' if request.endpoint == 'dashboard' else '' }}">Panel</a>
                    {# --- CORREGIDO: Cambiado 'manage_data' por 'view_data' --- #}
                    {# Enlace a la p√°gina de visualizaci√≥n de Datos cargados #}
                    <a href="{{ url_for('view_data') }}" class="{{ 'active' if request.endpoint == 'view_data' or request.endpoint == 'upload_data' else '' }}">Datos</a> {# Considerar 'upload_data' tambi√©n como activo si esa es la p√°gina relacionada #}
                    {# Enlace al Simulador #}
                    <a href="{{ url_for('simulate_threats_route') }}" class="{{ 'active' if request.endpoint == 'simulate_threats_route' else '' }}">Simulador</a> {# Aseg√∫rate que el nombre de la ruta sea 'simulate_threats_route' o como la definiste #}
                    {# Enlace a la p√°gina de Detecci√≥n #}
                    <a href="{{ url_for('detect_threats_route') }}" class="{{ 'active' if request.endpoint == 'detect_threats_route' else '' }}">Detecci√≥n</a> {# Aseg√∫rate que el nombre de la ruta sea 'detect_threats_route' o como la definiste #}
                    {# Enlace a la p√°gina de Alertas #}
                    <a href="{{ url_for('view_alerts') }}" class="{{ 'active' if request.endpoint == 'view_alerts' else '' }}">Alertas</a> {# Aseg√∫rate que el nombre de la ruta sea 'view_alerts' o como la definiste #}

                    {# Mostrar enlace de Admin solo si el usuario actual es administrador #}
                    {% if current_user.is_admin %}
                        {# Asumiendo que tienes una p√°gina de aterrizaje admin o quieres activar el link para cualquier ruta que empiece con 'admin' #}
                         <a href="{{ url_for('admin_model_config') }}" class="{{ 'active' if request.endpoint.startswith('admin_') or request.endpoint == 'admin_users' else '' }}">Admin</a> {# Ajusta el enlace y la condici√≥n 'active' seg√∫n tus rutas admin (ej. 'admin_landing', 'admin_users', etc.) #}
                    {% endif %}
                {% endif %} {# Fin if authenticated #}

                {# Links de Autenticaci√≥n (Login/Registro o Saludo/Logout) #}
                {% if current_user.is_authenticated %}
                    {# Saludo al usuario logueado #}
                    <span class="nav-username">Hola, {{ current_user.username }}!</span>
                    {# Enlace para cerrar sesi√≥n #}
                    <a href="{{ url_for('logout') }}" class="nav-logout">Cerrar Sesi√≥n</a>
                {% else %}
                    {# Enlace para iniciar sesi√≥n #}
                    <a href="{{ url_for('login') }}" class="{{ 'active' if request.endpoint == 'login' else '' }}">Iniciar Sesi√≥n</a>
                    {# Enlace para registrarse #}
                    <a href="{{ url_for('register') }}" class="{{ 'active' if request.endpoint == 'register' else '' }}">Registrarse</a>
                {% endif %}
            </div>
        </div>
    </nav>

    <main class="container content-area">
        {# Secci√≥n para mostrar mensajes flash (alertas de sistema) #}
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                {% for category, message in messages %}
                    {# La categor√≠a puede ser 'success', 'danger', 'warning', 'info' etc. #}
                    <div class="alert alert-{{ category or 'info' }}">{{ message }}</div>
                {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        {# Aqu√≠ se insertar√° el contenido espec√≠fico de cada plantilla que extienda de base.html #}
        {% block content %}{% endblock %}
    </main>

    <footer>
        <div class="container">
            {# Mostrar a√±o actual (viene del context processor en app.py) #}
            <p>&copy; {{ current_year }} Sistema Inteligente de Ciberseguridad</p>
        </div>
    </footer>

    {# Enlace al archivo JavaScript principal #}
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    {# Bloque para a√±adir scripts JS adicionales espec√≠ficos de cada p√°gina #}
    {% block extra_js %}{% endblock %}

    <!-- Opcional: A√±adir script para cerrar mensajes flash autom√°ticamente -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.flash-messages .alert').forEach(function(alert) {
            setTimeout(function() {
                alert.style.opacity = '0';
                setTimeout(function() { alert.remove(); }, 500); // Espera la transici√≥n antes de remover
            }, 5000); // Ocultar despu√©s de 5 segundos
        });
    });
    </script>

</body>
</html>